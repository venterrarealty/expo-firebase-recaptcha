{"version":3,"file":"FirebaseRecaptchaVerifierModal.js","sourceRoot":"","sources":["../src/FirebaseRecaptchaVerifierModal.tsx"],"names":[],"mappings":"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","sourcesContent":["import { CodedError } from 'expo-modules-core';\nimport * as React from 'react';\nimport {\n  StyleSheet,\n  Button,\n  View,\n  SafeAreaView,\n  Text,\n  Modal,\n  ActivityIndicator,\n} from 'react-native';\n\nimport FirebaseRecaptcha from './FirebaseRecaptcha';\nimport { FirebaseAuthApplicationVerifier } from './FirebaseRecaptcha.types';\n\ninterface Props\n  extends Omit<\n    React.ComponentProps<typeof FirebaseRecaptcha>,\n    'onVerify' | 'invisible' | 'verify' | 'onVerify' | 'onLoad' | 'onError' | 'onFullChallenge'\n  > {\n  title?: string;\n  cancelLabel?: string;\n  attemptInvisibleVerification?: boolean;\n}\ninterface State {\n  visible: boolean;\n  visibleLoaded: boolean;\n  invisibleLoaded: boolean;\n  invisibleVerify: boolean;\n  invisibleKey: number;\n  resolve?: (token: string) => void;\n  reject?: (error: Error) => void;\n}\n\nexport default class FirebaseRecaptchaVerifierModal\n  extends React.Component<Props, State>\n  implements FirebaseAuthApplicationVerifier\n{\n  static defaultProps = {\n    title: 'reCAPTCHA',\n    cancelLabel: 'Cancel',\n  };\n\n  state: State = {\n    visible: false,\n    visibleLoaded: false,\n    invisibleLoaded: false,\n    invisibleVerify: false,\n    invisibleKey: 1,\n    resolve: undefined,\n    reject: undefined,\n  };\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    if (!props.attemptInvisibleVerification && state.invisibleLoaded) {\n      return {\n        invisibleLoaded: false,\n        invisibleVerify: false,\n      };\n    }\n    return null;\n  }\n\n  get type(): string {\n    return 'recaptcha';\n  }\n\n  async verify(): Promise<string> {\n    return new Promise((resolve, reject) => {\n      if (this.props.attemptInvisibleVerification) {\n        this.setState({\n          invisibleVerify: true,\n          resolve,\n          reject,\n        });\n      } else {\n        this.setState({\n          visible: true,\n          visibleLoaded: false,\n          resolve,\n          reject,\n        });\n      }\n    });\n  }\n\n  // see: https://github.com/expo/expo/issues/14780\n  _reset(...args: any): void {}\n\n  private onVisibleLoad = () => {\n    this.setState({\n      visibleLoaded: true,\n    });\n  };\n\n  private onInvisibleLoad = () => {\n    this.setState({\n      invisibleLoaded: true,\n    });\n  };\n\n  private onFullChallenge = async () => {\n    this.setState({\n      invisibleVerify: false,\n      visible: true,\n    });\n  };\n\n  private onError = () => {\n    const { reject } = this.state;\n    if (reject) {\n      reject(new CodedError('ERR_FIREBASE_RECAPTCHA_ERROR', 'Failed to load reCAPTCHA'));\n    }\n    this.setState({\n      visible: false,\n      invisibleVerify: false,\n    });\n  };\n\n  private onVerify = (token: string) => {\n    const { resolve } = this.state;\n    if (resolve) {\n      resolve(token);\n    }\n    this.setState((state) => ({\n      visible: false,\n      invisibleVerify: false,\n      invisibleLoaded: false,\n      invisibleKey: state.invisibleKey + 1,\n    }));\n  };\n\n  cancel = () => {\n    const { reject } = this.state;\n    if (reject) {\n      reject(new CodedError('ERR_FIREBASE_RECAPTCHA_CANCEL', 'Cancelled by user'));\n    }\n    this.setState({\n      visible: false,\n    });\n  };\n\n  onDismiss = () => {\n    // onDismiss should be called when the user dismisses the\n    // modal using a swipe gesture. Due to a bug in RN this\n    // unfortunately doesn't work :/\n    //https://github.com/facebook/react-native/issues/26892\n    if (this.state.visible) {\n      this.cancel();\n    }\n  };\n\n  render() {\n    const { title, cancelLabel, attemptInvisibleVerification, ...otherProps } = this.props;\n    const { visible, visibleLoaded, invisibleLoaded, invisibleVerify, invisibleKey } = this.state;\n    return (\n      <View style={styles.container}>\n        {attemptInvisibleVerification && (\n          <FirebaseRecaptcha\n            {...otherProps}\n            key={`invisible${invisibleKey}`}\n            style={styles.invisible}\n            onLoad={this.onInvisibleLoad}\n            onError={this.onError}\n            onVerify={this.onVerify}\n            onFullChallenge={this.onFullChallenge}\n            invisible\n            verify={invisibleLoaded && invisibleVerify}\n          />\n        )}\n        <Modal\n          visible={visible}\n          animationType=\"slide\"\n          presentationStyle=\"pageSheet\"\n          onRequestClose={this.cancel}\n          onDismiss={this.onDismiss}>\n          <SafeAreaView style={styles.modalContainer}>\n            <View style={styles.header}>\n              <Text style={styles.title}>{title}</Text>\n              <View style={styles.cancel}>\n                <Button\n                  title={cancelLabel || FirebaseRecaptchaVerifierModal.defaultProps.cancelLabel}\n                  onPress={this.cancel}\n                />\n              </View>\n            </View>\n            <View style={styles.content}>\n              <FirebaseRecaptcha\n                {...otherProps}\n                style={styles.content}\n                onLoad={this.onVisibleLoad}\n                onError={this.onError}\n                onVerify={this.onVerify}\n              />\n              {!visibleLoaded ? (\n                <View style={styles.loader}>\n                  <ActivityIndicator size=\"large\" />\n                </View>\n              ) : undefined}\n            </View>\n          </SafeAreaView>\n        </Modal>\n      </View>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    width: 0,\n    height: 0,\n  },\n  invisible: {\n    width: 300,\n    height: 300,\n  },\n  modalContainer: {\n    flex: 1,\n  },\n  header: {\n    backgroundColor: '#FBFBFB',\n    height: 44,\n    flexDirection: 'row',\n    justifyContent: 'center',\n    alignItems: 'center',\n    borderBottomColor: '#CECECE',\n    borderBottomWidth: StyleSheet.hairlineWidth,\n  },\n  cancel: {\n    position: 'absolute',\n    left: 8,\n    justifyContent: 'center',\n  },\n  title: {\n    fontWeight: 'bold',\n  },\n  content: {\n    flex: 1,\n  },\n  loader: {\n    ...StyleSheet.absoluteFillObject,\n    paddingTop: 20,\n    justifyContent: 'flex-start',\n    alignItems: 'center',\n  },\n});\n"]}